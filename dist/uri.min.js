/*
 URI.js v1.4 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js
*/
if(typeof exports==="undefined")exports={};if(typeof require!=="function")require=function(){return exports};
URI=function(){function k(){this.errors=[]}function r(a){return a===undefined?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}function v(a){for(var b="",c=0,d,g,w;c<a.length;){d=parseInt(a.substr(c+1,2),16);if(d<128){b+=String.fromCharCode(d);c+=3}else if(d>191&&d<224){g=parseInt(a.substr(c+4,2),16);b+=String.fromCharCode((d&31)<<6|g&63);c+=6}else{g=parseInt(a.substr(c+4,2),16);w=parseInt(a.substr(c+7,2),16);b+=String.fromCharCode((d&
15)<<12|(g&63)<<6|w&63);c+=9}}return b}function y(a){for(var b="",c=0,d;c<a.length;){d=parseInt(a.substr(c+1,2),16);if(d<128){d=String.fromCharCode(d);b+=d.match(J)?d:a.substr(c,3);c+=3}else if(d>191&&d<224){b+=a.substr(c,6);c+=6}else{b+=a.substr(c,9);c+=9}}return b}function n(a){a=a.charCodeAt(0);return a<128?"%"+a.toString(16).toUpperCase():a>127&&a<2048?"%"+(a>>6|192).toString(16).toUpperCase()+"%"+(a&63|128).toString(16).toUpperCase():"%"+(a>>12|224).toString(16).toUpperCase()+"%"+(a>>6&63|128).toString(16).toUpperCase()+
"%"+(a&63|128).toString(16).toUpperCase()}function e(a){return"(?:"+a+")"}function j(){for(var a=arguments[0],b=1,c=arguments[b];c;){a=a.slice(0,-1)+c.slice(1);c=arguments[++b]}return a}var l=j("[0-9]","[A-Fa-f]"),h=e("%"+l+l),o=j("[\\:\\/\\?\\#\\[\\]\\@]","[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),i=j("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]"),m=e("[A-Za-z]"+j("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),p=e(e(h+"|"+j(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]"))+"*"),q=e(e("25[0-5]")+"|"+e("2[0-4][0-9]")+"|"+
e("1[0-9][0-9]")+"|"+e("[1-9][0-9]")+"|[0-9]");q=e(q+"\\."+q+"\\."+q+"\\."+q);var u=e(j(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]")+"+");l=e("v"+l+"+\\."+j(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]")+"+");l=e("\\["+e(u+"|"+l)+"\\]");u=e(e(h+"|"+j(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"))+"*");q=e(l+"|"+q+"|"+u);l=e("[0-9]*");u=e(e(p+"@")+"?"+q+e("\\:"+l)+"?");var s=e(h+"|"+j(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:\\@]")),t=e(s+"*"),C=e(s+"+"),x=e(e(h+"|"+j(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",
"[\\@]"))+"+");t=e(e("\\/"+t)+"*");var z=e("\\/"+e(C+t)+"?");x=e(x+t);var A=e(""),B=e(e(s+"|[\\/\\?]")+"*");s=e(e(s+"|[\\/\\?]")+"*");var D=e(e(e("\\/\\/"+u+t)+"|"+z+"|"+x+"|"+A)+e("\\?"+B)+"?"+e("\\#"+s)+"?");m="^("+m+")\\:"+e(e("\\/\\/("+e("("+p+")@")+"?("+q+")"+e("\\:("+l+")")+"?)")+"?("+t+"|"+z+"|"+e(C+t)+"|"+A+")")+e("\\?("+B+")")+"?"+e("\\#("+s+")")+"?$";D="^(){0}"+e(e("\\/\\/("+e("("+p+")@")+"?("+q+")"+e("\\:("+l+")")+"?)")+"?("+t+"|"+z+"|"+x+"|"+A+")")+e("\\?("+B+")")+"?"+e("\\#("+s+")")+
"?$";u="^"+e("("+p+")@")+"?("+q+")"+e("\\:("+l+")")+"?$";var K=RegExp("("+m+")|("+D+")"),L=RegExp(j("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),M=RegExp(j("[^\\%\\:]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),N=RegExp(j("[^\\%]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),O=RegExp(j("[^\\%\\/\\:\\@]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),P=RegExp(j("[^\\%\\/\\@]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),E=RegExp(j("[^\\%]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:\\@\\/\\?]"),
"g"),Q=RegExp(j("[^]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),J=RegExp(i,"g");j("[^\\%]",i,o);var F=RegExp(h+"+","g"),R=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?([^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n)*))?/i,G=/^\.\.?\//,H=/^\/\.(\/|$)/,I=/^\/\.\.(\/|$)/,S=/^\/?(?:.|\n)*?(?=\/|$)/,T="".match(/(){0}/)[1]===undefined,f=exports;k.prototype={scheme:undefined,userinfo:undefined,host:undefined,port:undefined,path:undefined,query:undefined,fragment:undefined,reference:undefined,
errors:undefined};f.a={};f.parse=function(a,b){var c,d=new k;a=a?a.toString():"";b=b||{};if(b.reference==="suffix")a=(b.scheme?b.scheme+":":"")+"//"+a;if(c=a.match(K))c=c[1]?c.slice(1,10):c.slice(10,19);if(!c){b.tolerant||d.errors.push("URI is not strictly valid.");c=a.match(R)}if(c){if(T){d.scheme=c[1];d.userinfo=c[3];d.host=c[4];d.port=parseInt(c[5],10);d.path=c[6]||"";d.query=c[7];d.fragment=c[8];if(isNaN(d.port))d.port=c[5]}else{d.scheme=c[1]||undefined;d.userinfo=a.indexOf("@")!==-1?c[3]:undefined;
d.host=a.indexOf("//")!==-1?c[4]:undefined;d.port=parseInt(c[5],10);d.path=c[6]||"";d.query=a.indexOf("?")!==-1?c[7]:undefined;d.fragment=a.indexOf("#")!==-1?c[8]:undefined;if(isNaN(d.port))d.port=a.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?c[4]:undefined}d.reference=d.scheme===undefined&&d.userinfo===undefined&&d.host===undefined&&d.port===undefined&&d.path===undefined&&d.query===undefined?"same-document":d.scheme===undefined?"relative":d.fragment===undefined?"absolute":"uri";b.reference&&b.reference!==
"suffix"&&b.reference!==d.reference&&d.errors.push("URI is not a "+b.reference+" reference.");(c=f.a[(b.scheme||d.scheme||"").toLowerCase()])&&c.parse&&c.parse(d,b)}else d.errors.push("URI can not be parsed.");return d};f.e=function(a){var b=[];if(a.userinfo!==undefined){b.push(a.userinfo.toString().replace(M,n));b.push("@")}a.host!==undefined&&b.push(a.host.toString().toLowerCase().replace(N,n));if(typeof a.port==="number"){b.push(":");b.push(a.port.toString(10))}return b.length?b.join(""):undefined};
f.b=function(a){for(var b=[],c;a.length;)if(a.match(G))a=a.replace(G,"");else if(a.match(H))a=a.replace(H,"/");else if(a.match(I)){a=a.replace(I,"/");b.pop()}else if(a==="."||a==="..")a="";else{c=a.match(S)[0];a=a.slice(c.length);b.push(c)}return b.join("")};f.serialize=function(a,b){var c=[],d,g;b=b||{};(d=f.a[(b.scheme||a.scheme||"").toLowerCase()])&&d.serialize&&d.serialize(a,b);if(b.reference!=="suffix"&&a.scheme){c.push(a.scheme.toString().toLowerCase().replace(L,""));c.push(":")}d=f.e(a);if(d!==
undefined){b.reference!=="suffix"&&c.push("//");c.push(d);a.path&&a.path.charAt(0)!=="/"&&c.push("/")}if(a.path!==undefined){g=f.b(a.path.toString().replace(/%2E/ig,"."));g=a.scheme?g.replace(O,n):g.replace(P,n);if(d===undefined)g=g.replace(/^\/\//,"/%2F");c.push(g)}if(a.query!==undefined){c.push("?");c.push(a.query.toString().replace(E,n))}if(a.fragment!==undefined){c.push("#");c.push(a.fragment.toString().replace(E,n))}return c.join("").replace(F,y).replace(/%[0-9A-Fa-f]{2}/g,function(w){return w.toUpperCase()})};
f.d=function(a,b,c,d){var g=new k;if(!d){a=f.parse(f.serialize(a,c),c);b=f.parse(f.serialize(b,c),c)}c=c||{};if(!c.tolerant&&b.scheme){g.scheme=b.scheme;g.userinfo=b.userinfo;g.host=b.host;g.port=b.port;g.path=f.b(b.path);g.query=b.query}else{if(b.userinfo!==undefined||b.host!==undefined||b.port!==undefined){g.userinfo=b.userinfo;g.host=b.host;g.port=b.port;g.path=f.b(b.path);g.query=b.query}else{if(b.path){if(b.path.charAt(0)==="/")g.path=f.b(b.path);else{g.path=(a.userinfo!==undefined||a.host!==
undefined||a.port!==undefined)&&!a.path?"/"+b.path:a.path?a.path.slice(0,a.path.lastIndexOf("/")+1)+b.path:b.path;g.path=f.b(g.path)}g.query=b.query}else{g.path=a.path;g.query=b.query!==undefined?b.query:a.query}g.userinfo=a.userinfo;g.host=a.host;g.port=a.port}g.scheme=a.scheme}g.fragment=b.fragment;return g};f.i=function(a,b,c){return f.serialize(f.d(f.parse(a,c),f.parse(b,c),c,true),c)};f.normalize=function(a,b){if(typeof a==="string")return f.serialize(f.parse(a,b),b);else if(r(a)==="object")return f.parse(f.serialize(a,
b),b);return a};f.f=function(a,b,c){if(typeof a==="string")a=f.serialize(f.parse(a,c),c);else if(r(a)==="object")a=f.serialize(a,c);if(typeof b==="string")b=f.serialize(f.parse(b,c),c);else if(r(b)==="object")b=f.serialize(b,c);return a===b};f.g=function(a){return a&&a.toString().replace(Q,n)};f.j=function(a){return a&&a.toString().replace(F,v)};exports.h=n;exports.k=v;exports.Components=k;exports.c=f;exports.pctEncChar=n;exports.pctDecChars=v;exports.Components=k;exports.URI={SCHEMES:f.a,parse:f.parse,
removeDotSegments:f.b,serialize:f.serialize,resolveComponents:f.d,resolve:f.i,normalize:f.normalize,equal:f.f,escapeComponent:f.g,unescapeComponent:f.j};require("./schemes");return f}();require("../uri").c.a.http={serialize:function(k){if(k.port===80||k.port==="")k.port=undefined;if(!k.path)k.path="/";return k}};(function(){var k=require("../uri"),r=k.c,v=k.h,y=/^urn\:((?:[0-9A-Za-z][0-9A-Za-z\-]{1,31}))$/,n=RegExp("^((?:[0-9A-Za-z][0-9A-Za-z\\-]{1,31}))\\:((?:(?:(?:\\%[0-9A-Fa-f]{2})|[0-9A-Za-z\\(\\)\\+\\,\\-\\.\\:\\=\\@\\;\\$\\_\\!\\*\\'\\/\\?\\#])+))$"),e=/^([^\:]+)\:(.*)/,j=/[\x00-\x20\\\"\&\<\>\[\]\^\`\{\|\}\~\x7F-\xFF]/g,l=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/;r.a.urn={parse:function(h,o){var i=h.path.match(n),m,p;if(!i){o.tolerant||h.errors.push("URN is not strictly valid.");i=
h.path.match(e)}if(i){m="urn:"+i[1].toLowerCase();(p=r.a[m])||(p=r.a[m]={});if(!p.serialize)p.serialize=r.a.urn.serialize;h.scheme=m;h.path=i[2];p.parse&&p.parse(h,o)}else h.errors.push("URN can not be parsed.");return h},serialize:function(h,o){var i=h.scheme||o.scheme,m;if(i&&i!=="urn"){(m=i.match(y))||(m=["urn:"+i,i]);h.scheme="urn";h.path=m[1]+":"+(h.path?h.path.replace(j,v):"")}return h}};r.a["urn:uuid"]={parse:function(h,o){if(!o.tolerant&&(!h.path||!h.path.match(l)))h.errors.push("UUID is not valid.")},
serialize:function(h,o){if(!o.tolerant&&(!h.path||!h.path.match(l)))h.scheme=undefined;else h.path=(h.path||"").toLowerCase();return r.a.urn.serialize(h,o)}}})();
